generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// -----------CORE ENTITIES----------

model Company {
  id        String   @id @default(uuid())
  name      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  users        User[]
  departments  Department[]
  designations Designation[]
  employees    EmployeeProfile[]
}

model User {
  id            String       @id @default(uuid())
  email         String       @unique
  passwordHash  String?
  authProvider  AuthProvider
  providerId    String?
  isActive      Boolean      @default(true)

  companyId     String
  company       Company      @relation(fields: [companyId], references: [id])

  employee      EmployeeProfile?

  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  @@index([companyId])
}

// ---------ORGANIZATION-----------

model Department {
  id        String   @id @default(uuid())
  name      String
  companyId String
  company   Company  @relation(fields: [companyId], references: [id])

  teams     Team[]

  createdAt DateTime @default(now())

  @@unique([companyId, name])
  @@index([companyId])
}

model Team {
  id           String   @id @default(uuid())
  name         String
  departmentId String
  department   Department @relation(fields: [departmentId], references: [id])

  employees    EmployeeProfile[]

  createdAt    DateTime @default(now())

  @@unique([departmentId, name])
}

model Designation {
  id        String   @id @default(uuid())
  name      String
  companyId String
  company   Company  @relation(fields: [companyId], references: [id])

  employees EmployeeProfile[]

  createdAt DateTime @default(now())

  @@unique([companyId, name])
}


// ----------EMPLOYEE-----------


model EmployeeProfile {
  id             String   @id @default(uuid())
  
  employeeCode   Int
  
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id])

  companyId      String
  company        Company  @relation(fields: [companyId], references: [id])

  designationId  String
  designation    Designation @relation(fields: [designationId], references: [id])

  teamId         String
  team           Team     @relation(fields: [teamId], references: [id])

  managerId      String?
  manager        EmployeeProfile? @relation("ManagerRelation", fields: [managerId], references: [id])
  subordinates   EmployeeProfile[] @relation("ManagerRelation")
  
  firstName      String
  middleName     String?
  lastName       String
  displayName    String
  
  isProbation    Boolean  @default(true)
  joiningDate    DateTime

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([companyId, employeeCode])
  @@index([companyId])
  @@index([managerId])
}


// ---------ENUMS------


enum AuthProvider {
  LOCAL
  GOOGLE
}
